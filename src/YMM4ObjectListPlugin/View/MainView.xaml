<UserControl
  x:Class="ObjectList.View.MainView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:c="clr-namespace:YukkuriMovieMaker.Controls;assembly=YukkuriMovieMaker.Controls"
  xmlns:core="clr-namespace:ObjectList"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:epoxy="https://github.com/kekyo/Epoxy"
  xmlns:loc="clr-namespace:YukkuriMovieMaker.Resources.Localization;assembly=YukkuriMovieMaker.Plugin"
  xmlns:local="clr-namespace:ObjectList.View"
  xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d"
  >
  <epoxy:EventBinder.Events>
    <epoxy:Event Command="{Binding Ready}" EventName="Loaded" />
  </epoxy:EventBinder.Events>

  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Resources/IconResources.xaml" />
      </ResourceDictionary.MergedDictionaries>

      <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

      <!--  å…±é€šã®ColumnHeaderStyleã‚’å®šç¾©  -->
      <Style
        x:Key="BaseColumnHeaderStyle"
        BasedOn="{StaticResource {x:Type DataGridColumnHeader}}"
        TargetType="DataGridColumnHeader"
        >
        <Setter Property="Height" Value="22" />
        <Setter Property="MinHeight" Value="20" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="FontSize" Value="11" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
      </Style>

      <!--  å·¦å¯„ã›ç”¨ã®HeaderStyle  -->
      <Style
        x:Key="LeftAlignColumnHeaderStyle"
        BasedOn="{StaticResource BaseColumnHeaderStyle}"
        TargetType="DataGridColumnHeader"
        >
        <Setter Property="HorizontalContentAlignment" Value="Left" />
      </Style>

    </ResourceDictionary>

  </UserControl.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>


    <DockPanel Grid.Row="0">
      <Button
        Width="24"
        Height="24"
        Margin="5,5,5,0"
        Command="{Binding ReloadCommand}"
        DockPanel.Dock="Right"
        ToolTip="{x:Static loc:Texts.Reload}"
        >
        <Image Margin="2" Source="{StaticResource mdiReload}" />
      </Button>

      <!--  ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³  -->
      <ToggleButton
        x:Name="FilterMenuToggle"
        Margin="0,5,5,0"
        HorizontalAlignment="Left"
        Content="{materialIcons:MaterialIconExt Kind=Filter,
                                                Size=16}"
        DockPanel.Dock="Right"
        IsChecked="{Binding IsFilterMenuOpen, Mode=TwoWay}"
        />

      <!--  ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼  -->
      <Popup
        x:Name="FilterPopup"
        AllowsTransparency="True"
        IsOpen="{Binding IsFilterMenuOpen, Mode=TwoWay}"
        Placement="Bottom"
        PlacementTarget="{Binding ElementName=FilterMenuToggle}"
        PopupAnimation="Fade"
        StaysOpen="False"
        >
        <Border
          Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
          BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
          BorderThickness="1"
          CornerRadius="3"
          >
          <Border.Effect>
            <DropShadowEffect
              BlurRadius="5"
              Opacity="0.3"
              ShadowDepth="2"
              Color="Black"
              />
          </Border.Effect>
          <StackPanel Margin="5">

            <!--  ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³  -->
            <TextBlock
              Margin="5,0,5,5"
              FontWeight="Bold"
              Foreground="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"
              Text="ðŸ“Š ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetFilterCommand}"
              CommandParameter="All"
              Content="ã™ã¹ã¦"
              GroupName="FilterOptions"
              IsChecked="{Binding IsAllFilterSelected}"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetFilterCommand}"
              CommandParameter="UnderSeekBar"
              Content="ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã®ä¸‹"
              GroupName="FilterOptions"
              IsChecked="{Binding IsUnderSeekBarFilterSelected}"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetFilterCommand}"
              CommandParameter="Range"
              Content="ç¯„å›²æŒ‡å®š"
              GroupName="FilterOptions"
              IsChecked="{Binding IsRangeFilterSelected}"
              />

            <!--  ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ãƒ¼  -->
            <Separator Margin="0,5" />

            <!--  ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³  -->
            <TextBlock
              Margin="5,5,5,5"
              FontWeight="Bold"
              Foreground="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"
              Text="ðŸ“ ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetGroupingCommand}"
              CommandParameter="None"
              Content="ãªã—"
              GroupName="GroupingOptions"
              IsChecked="{Binding IsNoneGroupingSelected}"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetGroupingCommand}"
              CommandParameter="Category"
              Content="ã‚«ãƒ†ã‚´ãƒª"
              GroupName="GroupingOptions"
              IsChecked="{Binding IsCategoryGroupingSelected}"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetGroupingCommand}"
              CommandParameter="Layer"
              Content="ãƒ¬ã‚¤ãƒ¤ãƒ¼"
              GroupName="GroupingOptions"
              IsChecked="{Binding IsLayerGroupingSelected}"
              />

            <RadioButton
              Margin="10,2"
              Command="{Binding SetGroupingCommand}"
              CommandParameter="Group"
              Content="ã‚°ãƒ«ãƒ¼ãƒ—"
              GroupName="GroupingOptions"
              IsChecked="{Binding IsGroupGroupingSelected}"
              />

          </StackPanel>
        </Border>
      </Popup>


      <!--  æ¤œç´¢ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹  -->
      <TextBox
        Margin="5,5,5,0"
        DockPanel.Dock="Left"
        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
        >
        <TextBox.Style>
          <Style TargetType="TextBox">
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="TextBox">
                  <Border
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    >
                    <Grid>
                      <ScrollViewer x:Name="PART_ContentHost" />
                      <TextBlock
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Foreground="Gray"
                        IsHitTestVisible="False"
                        Text="ã‚¿ã‚¤ãƒˆãƒ«ã§æ¤œç´¢..."
                        >
                        <TextBlock.Style>
                          <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBlock.Style>
                      </TextBlock>
                    </Grid>
                  </Border>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Style>
        </TextBox.Style>
      </TextBox>



    </DockPanel>

    <!--  ã‚µãƒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³é ˜åŸŸ  -->
    <StackPanel
      Name="SubOptionsPanel"
      Grid.Row="1"
      Orientation="Horizontal"
      >
      <StackPanel
        Name="RangeFilterOptions"
        Margin="10,2,2,2"
        Orientation="Horizontal"
        Visibility="{Binding IsRangeFilterSelected, Converter={StaticResource BoolToVisibilityConverter}}"
        >

        <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" BorderThickness="1">
          <DockPanel>
            <Button DockPanel.Dock="Left">
              <Label ToolTip="é–‹å§‹">
                <materialIcons:MaterialIconExt Kind="ClockStart" Size="16" />
              </Label>
            </Button>
            <c:FrameNumberEditor
              Name="RangeFilterStart"
              Width="200"
              DefaultValue="0"
              Max="10000"
              Min="0"
              />

          </DockPanel>
        </Border>

        <TextBlock
          Margin="20,5"
          VerticalAlignment="Center"
          Text="ï½ž"
          />

        <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" BorderThickness="1">
          <DockPanel>
            <Button DockPanel.Dock="Left">
              <Label ToolTip="çµ‚äº†">
                <materialIcons:MaterialIconExt Kind="ClockEnd" Size="16" />
              </Label>
            </Button>
            <c:FrameNumberEditor
              Name="RangeFilterEnd"
              Width="200"
              DefaultValue="1024"
              Max="10000"
              Min="0"
              />
          </DockPanel>
        </Border>
      </StackPanel>
    </StackPanel>

    <!--  DataGrid  -->
    <DataGrid
      x:Name="CustomerDataGrid"
      Grid.Row="2"
      Margin="0,5,0,0"
      AlternationCount="2"
      AutoGenerateColumns="False"
      CanUserAddRows="False"
      CanUserDeleteRows="True"
      CanUserReorderColumns="True"
      HeadersVisibility="Column"
      ItemsSource="{Binding FilteredItems}"
      SelectionMode="Extended"
      >
      <epoxy:EventBinder.Events>
        <epoxy:Event Command="{Binding SelectionChangedCommand}" EventName="SelectionChanged" />
      </epoxy:EventBinder.Events>
      <DataGrid.Resources>
        <Style TargetType="DataGridCell">
          <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
        <Style TargetType="TextBlock">
          <Setter Property="VerticalAlignment" Value="Center" />
          <Setter Property="TextAlignment" Value="Center" />
        </Style>
      </DataGrid.Resources>

      <!--  DataGridã§å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨  -->
      <DataGrid.ColumnHeaderStyle>
        <StaticResource ResourceKey="BaseColumnHeaderStyle" />
      </DataGrid.ColumnHeaderStyle>


      <!--  è¡Œã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ   -->
      <DataGrid.RowStyle>
        <Style TargetType="DataGridRow">
          <Style.Triggers>
            <Trigger Property="AlternationIndex" Value="1">
              <Setter Property="Background">
                <Setter.Value>
                  <SolidColorBrush Opacity="0.1" Color="{DynamicResource {x:Static SystemColors.AccentColorKey}}" />
                </Setter.Value>
              </Setter>
            </Trigger>
          </Style.Triggers>
        </Style>
      </DataGrid.RowStyle>


      <DataGrid.Columns>

        <DataGridTemplateColumn IsReadOnly="True" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnColor, Converter={StaticResource BoolToVisibilityConverter}}">
          <DataGridTemplateColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiPaletteOutline}"
              ToolTip="{x:Static loc:Texts.BaseItemColorName}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Rectangle
                Width="10"
                Height="20"
                VerticalAlignment="Center"
                Fill="{Binding ColorBrush}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTextColumn
          Width="SizeToCells"
          MinWidth="70"
          Binding="{Binding Category}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Category"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnCategory, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.HeaderStyle>
            <StaticResource ResourceKey="LeftAlignColumnHeaderStyle" />
          </DataGridTextColumn.HeaderStyle>
          <DataGridTextColumn.Header>
            <StackPanel Margin="2,0" Orientation="Horizontal">
              <Image
                Width="12"
                Margin="2,0"
                Source="{StaticResource mdiSitemap}"
                ToolTip="{x:Static loc:Texts.SearchResultItemColumnHeader}"
                />
              <TextBlock Margin="2,0" Text="ã‚«ãƒ†ã‚´ãƒª" />
            </StackPanel>

          </DataGridTextColumn.Header>

        </DataGridTextColumn>
        <DataGridTextColumn
          Width="*"
          Binding="{Binding Label}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Label"
          >
          <!--  Labelåˆ—ã§å·¦å¯„ã›ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨  -->
          <DataGridTextColumn.HeaderStyle>
            <StaticResource ResourceKey="LeftAlignColumnHeaderStyle" />
          </DataGridTextColumn.HeaderStyle>
          <DataGridTextColumn.Header>
            <StackPanel Margin="2,0" Orientation="Horizontal">
              <Image
                Width="12"
                Margin="2,0"
                Source="{StaticResource mdiNameLabel}"
                ToolTip="{x:Static loc:Texts.SearchResultItemColumnHeader}"
                />
              <TextBlock Margin="2,0" Text="{x:Static loc:Texts.SearchResultItemColumnHeader}" />
            </StackPanel>

          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Layer}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Layer"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLayer, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiLayers}"
              ToolTip="{x:Static loc:Texts.BaseItemLayerName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Frame}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Frame"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnFrame, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiTimelineClock}"
              ToolTip="{x:Static loc:Texts.BaseItemFrameName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Length}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Length"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLength, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiArrowExpandHorizontal}"
              ToolTip="{x:Static loc:Texts.BaseItemLengthName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Group}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Group"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnGroup, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiGroup}"
              ToolTip="{x:Static loc:Texts.GroupLabel}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          SortMemberPath="IsLocked"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLock, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTemplateColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiLock}"
              ToolTip="{x:Static loc:Texts.BaseItemIsLockedDesc}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsLocked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          SortMemberPath="IsHidden"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnHidden, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTemplateColumn.Header>
            <Image
              Width="12"
              Margin="2,0"
              HorizontalAlignment="Center"
              Source="{StaticResource mdiEyeOffOutline}"
              ToolTip="{x:Static loc:Texts.BaseItemIsHiddenDesc}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsHidden, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>

    <!--  Footer  -->
    <DockPanel Grid.Row="3" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooter, Converter={StaticResource BoolToVisibilityConverter}}">
      <WrapPanel
        Margin="5,0,5,0"
        HorizontalAlignment="Right"
        DockPanel.Dock="Right"
        >
        <!--  Scene Name  -->
        <TextBlock Text="{Binding SceneName}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneName, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneName, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!--  Scene Screen Size  -->
        <TextBlock Text="{Binding SceneScreenSize}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneScreenSize, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneScreenSize, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!--  Scene FPS  -->
        <TextBlock Text="{Binding SceneFps}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneFps, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneFps, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!--  Scene Hz  -->
        <TextBlock Text="{Binding SceneHz}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneHz, Converter={StaticResource BoolToVisibilityConverter}}" />
      </WrapPanel>
    </DockPanel>
  </Grid>

</UserControl>
