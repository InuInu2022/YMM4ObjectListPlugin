<UserControl
  x:Class="ObjectList.View.MainView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:c="clr-namespace:YukkuriMovieMaker.Controls;assembly=YukkuriMovieMaker.Controls"
  xmlns:core="clr-namespace:ObjectList"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:epoxy="https://github.com/kekyo/Epoxy"
  xmlns:loc="clr-namespace:YukkuriMovieMaker.Resources.Localization;assembly=YukkuriMovieMaker.Plugin"
  xmlns:local="clr-namespace:ObjectList.View"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d"
  >
  <epoxy:EventBinder.Events>
    <epoxy:Event Command="{Binding Ready}" EventName="Loaded" />
  </epoxy:EventBinder.Events>

  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Resources/IconResources.xaml" />
      </ResourceDictionary.MergedDictionaries>

      <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </ResourceDictionary>
  </UserControl.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>


    <DockPanel Grid.Row="0">
      <Button
        Width="24"
        Height="24"
        Margin="5,5,5,0"
        Command="{Binding ReloadCommand}"
        DockPanel.Dock="Right"
        ToolTip="{x:Static loc:Texts.Reload}"
        >
        <Image Margin="2" Source="{StaticResource mdiReload}" />
      </Button>
      <!--  検索テキストボックス  -->
      <TextBox
        Margin="5,5,5,0"
        DockPanel.Dock="Left"
        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
        >
        <TextBox.Style>
          <Style TargetType="TextBox">
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="TextBox">
                  <Border
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    >
                    <Grid>
                      <ScrollViewer x:Name="PART_ContentHost" />
                      <TextBlock
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Foreground="Gray"
                        IsHitTestVisible="False"
                        Text="タイトルで検索..."
                        >
                        <TextBlock.Style>
                          <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBlock.Style>
                      </TextBlock>
                    </Grid>
                  </Border>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Style>
        </TextBox.Style>
      </TextBox>

    </DockPanel>

    <!--  DataGrid  -->
    <DataGrid
      x:Name="CustomerDataGrid"
      Grid.Row="1"
      Margin="0,5,0,0"
      AlternationCount="2"
      AutoGenerateColumns="False"
      CanUserAddRows="False"
      CanUserDeleteRows="True"
      CanUserReorderColumns="True"
      HeadersVisibility="Column"
      ItemsSource="{Binding FilteredItems}"
      SelectionMode="Extended"
      >
      <epoxy:EventBinder.Events>
        <epoxy:Event Command="{Binding SelectionChangedCommand}" EventName="SelectionChanged" />
      </epoxy:EventBinder.Events>
      <DataGrid.Resources>
        <Style TargetType="DataGridCell">
          <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
        <Style TargetType="TextBlock">
          <Setter Property="VerticalAlignment" Value="Center" />
          <Setter Property="TextAlignment" Value="Center" />
        </Style>
      </DataGrid.Resources>
      <!--  行スタイルを追加  -->
      <DataGrid.RowStyle>
        <Style TargetType="DataGridRow">
          <Style.Triggers>
            <Trigger Property="AlternationIndex" Value="1">
              <Setter Property="Background">
                <Setter.Value>
                  <SolidColorBrush Opacity="0.05" Color="{DynamicResource {x:Static SystemColors.ControlTextColorKey}}" />
                </Setter.Value>
              </Setter>
            </Trigger>
          </Style.Triggers>
        </Style>
      </DataGrid.RowStyle>
      <DataGrid.Columns>

        <DataGridTemplateColumn IsReadOnly="True" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnColor, Converter={StaticResource BoolToVisibilityConverter}}">
          <DataGridTemplateColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiPaletteOutline}"
              ToolTip="{x:Static loc:Texts.BaseItemColorName}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Rectangle
                Width="10"
                Height="20"
                VerticalAlignment="Center"
                Fill="{Binding ColorBrush}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTextColumn
          Width="SizeToCells"
          MinWidth="70"
          Binding="{Binding Category}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Category"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnCategory, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <StackPanel Orientation="Horizontal">
              <Image
                Width="14"
                Margin="2"
                Source="{StaticResource mdiSitemap}"
                ToolTip="{x:Static loc:Texts.SearchResultItemColumnHeader}"
                />
              <Label Content="カテゴリ" />
            </StackPanel>

          </DataGridTextColumn.Header>

        </DataGridTextColumn>
        <DataGridTextColumn
          Width="*"
          Binding="{Binding Label}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Label"
          >
          <DataGridTextColumn.Header>
            <StackPanel Orientation="Horizontal">
              <Image
                Width="14"
                Margin="2"
                Source="{StaticResource mdiNameLabel}"
                ToolTip="{x:Static loc:Texts.SearchResultItemColumnHeader}"
                />
              <Label Content="{x:Static loc:Texts.SearchResultItemColumnHeader}" />
            </StackPanel>

          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Layer}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Layer"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLayer, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiLayers}"
              ToolTip="{x:Static loc:Texts.BaseItemLayerName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Frame}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Frame"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnFrame, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiTimelineClock}"
              ToolTip="{x:Static loc:Texts.BaseItemFrameName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Length}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Length"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLength, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiArrowExpandHorizontal}"
              ToolTip="{x:Static loc:Texts.BaseItemLengthName}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Group}"
          CanUserSort="True"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Group"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnGroup, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTextColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiGroup}"
              ToolTip="{x:Static loc:Texts.GroupLabel}"
              />
          </DataGridTextColumn.Header>
        </DataGridTextColumn>
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          SortMemberPath="IsLocked"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnLock, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTemplateColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiLock}"
              ToolTip="{x:Static loc:Texts.BaseItemIsLockedDesc}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsLocked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          SortMemberPath="IsHidden"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowColumnHidden, Converter={StaticResource BoolToVisibilityConverter}}"
          >
          <DataGridTemplateColumn.Header>
            <Image
              Width="14"
              Margin="2"
              Source="{StaticResource mdiEyeOffOutline}"
              ToolTip="{x:Static loc:Texts.BaseItemIsHiddenDesc}"
              />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsHidden, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>

    <!--  Footer  -->
    <DockPanel Grid.Row="2" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooter, Converter={StaticResource BoolToVisibilityConverter}}">
      <WrapPanel
        Margin="5,0,5,0"
        HorizontalAlignment="Right"
        DockPanel.Dock="Right"
        >
        <!-- Scene Name -->
        <TextBlock Text="{Binding SceneName}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneName, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneName, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!-- Scene Screen Size -->
        <TextBlock Text="{Binding SceneScreenSize}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneScreenSize, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneScreenSize, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!-- Scene FPS -->
        <TextBlock Text="{Binding SceneFps}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneFps, Converter={StaticResource BoolToVisibilityConverter}}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneFps, Converter={StaticResource BoolToVisibilityConverter}}"
          />
        <!-- Scene Hz -->
        <TextBlock Text="{Binding SceneHz}" Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooterSceneHz, Converter={StaticResource BoolToVisibilityConverter}}" />
      </WrapPanel>
    </DockPanel>
  </Grid>

</UserControl>
