<UserControl
  x:Class="ObjectList.View.MainView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:c="clr-namespace:YukkuriMovieMaker.Controls;assembly=YukkuriMovieMaker.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:epoxy="https://github.com/kekyo/Epoxy"
  xmlns:loc="clr-namespace:YukkuriMovieMaker.Resources.Localization;assembly=YukkuriMovieMaker.Plugin"
  xmlns:local="clr-namespace:ObjectList.View"
  xmlns:core="clr-namespace:ObjectList"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d"
  >
  <epoxy:EventBinder.Events>
    <epoxy:Event Command="{Binding Ready}" EventName="Loaded" />
  </epoxy:EventBinder.Events>

  <UserControl.Resources>
    <!--  DrawingImageをリソースとして定義  -->
    <DrawingImage x:Key="MyIcon">
      <DrawingImage.Drawing>
        <GeometryDrawing Brush="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Geometry="M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z" />
      </DrawingImage.Drawing>
    </DrawingImage>
    <DrawingImage x:Key="mdilEyeOff">
      <DrawingImage.Drawing>
        <GeometryDrawing
        Brush="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
        Geometry="M2.54,4.71L3.25,4L20,20.75L19.29,21.46L15.95,18.11C14.58,18.68 13.08,19 11.5,19C6.94,19 3,16.35 1.14,12.5C2.11,10.5 3.63,8.83 5.5,7.68L2.54,4.71M11.5,18C12.79,18 14.03,17.77 15.17,17.34L14.05,16.21C13.32,16.71 12.45,17 11.5,17C9,17 7,15 7,12.5C7,11.55 7.29,10.68 7.79,9.95L6.24,8.41C4.57,9.38 3.19,10.8 2.26,12.5C4.04,15.78 7.5,18 11.5,18M20.74,12.5C18.96,9.22 15.5,7 11.5,7C10.35,7 9.23,7.19 8.19,7.53L7.41,6.75C8.68,6.26 10.06,6 11.5,6C16.06,6 20,8.65 21.86,12.5C20.95,14.39 19.53,16 17.79,17.13L17.07,16.4C18.6,15.44 19.87,14.1 20.74,12.5M11.5,8C14,8 16,10 16,12.5C16,13.32 15.78,14.08 15.4,14.74L14.66,14C14.88,13.54 15,13.04 15,12.5C15,10.57 13.43,9 11.5,9C10.96,9 10.46,9.12 10,9.34L9.26,8.6C9.92,8.22 10.68,8 11.5,8M8,12.5C8,14.43 9.57,16 11.5,16C12.17,16 12.79,15.81 13.32,15.5L8.5,10.68C8.19,11.21 8,11.83 8,12.5Z" />
      </DrawingImage.Drawing>
    </DrawingImage>

    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
  </UserControl.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>


    <DockPanel Grid.Row="0">
      <Button
        Width="24"
        Height="24"
        Margin="5,5,5,0"
        Command="{Binding ReloadCommand}"
        DockPanel.Dock="Right"
        ToolTip="{x:Static loc:Texts.Reload}"
        >
        <Image Margin="2" Source="{StaticResource MyIcon}" />
      </Button>
      <!--  検索テキストボックス  -->
      <TextBox
        Margin="5,5,5,0"
        DockPanel.Dock="Left"
        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
        >
        <TextBox.Style>
          <Style TargetType="TextBox">
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="TextBox">
                  <Border
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    >
                    <Grid>
                      <ScrollViewer x:Name="PART_ContentHost" />
                      <TextBlock
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Foreground="Gray"
                        IsHitTestVisible="False"
                        Text="タイトルで検索..."
                        >
                        <TextBlock.Style>
                          <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBlock.Style>
                      </TextBlock>
                    </Grid>
                  </Border>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Style>
        </TextBox.Style>
      </TextBox>

    </DockPanel>

    <!--  DataGrid  -->
    <DataGrid
      x:Name="CustomerDataGrid"
      Grid.Row="1"
      Margin="0,5,0,0"
      AutoGenerateColumns="False"
      CanUserAddRows="False"
      CanUserDeleteRows="True"
      CanUserReorderColumns="True"
      HeadersVisibility="Column"
      ItemsSource="{Binding FilteredItems}"
      SelectionMode="Extended"
      AlternationCount="2"
      >
      <epoxy:EventBinder.Events>
        <epoxy:Event Command="{Binding SelectionChangedCommand}" EventName="SelectionChanged" />
      </epoxy:EventBinder.Events>
      <DataGrid.Resources>
        <Style TargetType="DataGridCell">
          <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
        <Style TargetType="TextBlock">
          <Setter Property="VerticalAlignment" Value="Center" />
          <Setter Property="TextAlignment" Value="Center" />
        </Style>
      </DataGrid.Resources>
      <!-- 行スタイルを追加 -->
      <DataGrid.RowStyle>
        <Style TargetType="DataGridRow">
          <Style.Triggers>
            <Trigger Property="AlternationIndex" Value="1">
              <Setter Property="Background">
                <Setter.Value>
                  <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ControlTextColorKey}}" Opacity="0.05" />
                </Setter.Value>
              </Setter>
            </Trigger>
          </Style.Triggers>
        </Style>
      </DataGrid.RowStyle>
      <DataGrid.Columns>

        <DataGridTemplateColumn
          Header="🎨"
          IsReadOnly="True">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Rectangle
                Width="10"
                Height="20"
                VerticalAlignment="Center"
                Fill="{Binding ColorBrush}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTextColumn
          Width="SizeToCells"
          MinWidth="70"
          Binding="{Binding Category}"
          CanUserSort="True"
          Header="カテゴリ"
          IsReadOnly="True"
          SortDirection="Ascending"
          />
        <DataGridTextColumn
          Width="*"
          Binding="{Binding Label}"
          CanUserSort="True"
          Header="{x:Static loc:Texts.SearchResultItemColumnHeader}"
          IsReadOnly="True"
          SortDirection="Ascending"
          />
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Layer}"
          CanUserSort="True"
          Header="{x:Static loc:Texts.SearchResultLayerColumnHeader}"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Layer"
          />
        <DataGridTextColumn
          Width="SizeToHeader"
          Binding="{Binding Group}"
          CanUserSort="True"
          Header="{x:Static loc:Texts.GroupLabel}"
          IsReadOnly="True"
          SortDirection="Ascending"
          SortMemberPath="Group"
          />
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          Header="🔒"
          SortMemberPath="IsLocked"
          >
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsLocked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTemplateColumn
          Width="SizeToCells"
          MinWidth="30"
          CanUserSort="True"
          SortMemberPath="IsHidden"
          >
          <DataGridTemplateColumn.Header>
            <Image Margin="2" Source="{StaticResource mdilEyeOff}" />
          </DataGridTemplateColumn.Header>
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:ToggleSlider
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Value="{Binding IsHidden, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>

    <!--  Footer  -->
    <DockPanel
      Grid.Row="2"
      Visibility="{Binding Source={x:Static core:ObjectListSettings.Default}, Path=IsShowFooter, Converter={StaticResource BoolToVisibilityConverter}}">
      <WrapPanel
        Margin="5,0,5,0"
        HorizontalAlignment="Right"
        DockPanel.Dock="Right"
        >
        <TextBlock Text="{Binding SceneName}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          />
        <TextBlock Text="{Binding SceneFps}" />
        <Border
          Width="1"
          Margin="5,2"
          Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
          />
        <TextBlock Text="{Binding SceneHz}" />
      </WrapPanel>
    </DockPanel>
  </Grid>

</UserControl>
